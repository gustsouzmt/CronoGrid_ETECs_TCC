{% extends "base.html" %}

{% block content %}
<h1 class="display-4 mb-4">Sistema de Geração de Grade Horária</h1>

<!-- Seção de Adicionar Professor -->
<div class="card shadow mb-5" id="professores-section">
    <div class="card-header bg-primary text-white">
        <h3 class="mb-0">
            <i class="fas fa-plus-circle me-2"></i>Adicionar Professor
        </h3>
    </div>
    <div class="card-body">
        <form method="POST" action="{{ url_for('main.adicionar_professor') }}">
            <div class="row mb-3">
                <div class="col-md-6">
                    <label for="nome" class="form-label">Nome do Professor</label>
                    <input type="text" class="form-control" id="nome" name="nome" required>
                </div>
                <div class="col-md-6">
                    <label for="email" class="form-label">E-mail</label>
                    <input type="email" class="form-control" id="email" name="email" required>
                </div>
            </div>
           <label class="form-label">Matérias</label>
            <div class="dropdown">
                <button class="form-control text-start dropdown-toggle" type="button" id="materiasDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                    Selecione as matérias...
                </button>
                <div class="dropdown-menu dropdown-menu-multiselect w-100" aria-labelledby="materiasDropdown" style="max-height: 300px; overflow-y: auto;">
                    <!-- Lista fixa de disciplinas extraídas das turmas -->
                    <div class="form-check"><input class="form-check-input materia-checkbox" type="checkbox" name="materias" value="DES. AÇÕES MKT" id="materia-des-acoes-mkt"><label class="form-check-label w-100" for="materia-des-acoes-mkt">DES. AÇÕES MKT</label></div>
                    <div class="form-check"><input class="form-check-input materia-checkbox" type="checkbox" name="materias" value="MATEMÁTICA" id="materia-matematica"><label class="form-check-label w-100" for="materia-matematica">MATEMÁTICA</label></div>
                    <div class="form-check"><input class="form-check-input materia-checkbox" type="checkbox" name="materias" value="LEG. EMP" id="materia-leg-emp"><label class="form-check-label w-100" for="materia-leg-emp">LEG. EMP</label></div>
                    <div class="form-check"><input class="form-check-input materia-checkbox" type="checkbox" name="materias" value="ALMOÇO" id="materia-almoco"><label class="form-check-label w-100" for="materia-almoco">ALMOÇO</label></div>
                    <div class="form-check"><input class="form-check-input materia-checkbox" type="checkbox" name="materias" value="EST. AVA. CH / SA" id="materia-est-ava-ch-sa"><label class="form-check-label w-100" for="materia-est-ava-ch-sa">EST. AVA. CH / SA</label></div>
                    <div class="form-check"><input class="form-check-input materia-checkbox" type="checkbox" name="materias" value="FÍSICA" id="materia-fisica"><label class="form-check-label w-100" for="materia-fisica">FÍSICA</label></div>
                    <div class="form-check"><input class="form-check-input materia-checkbox" type="checkbox" name="materias" value="GEOGRAFIA" id="materia-geografia"><label class="form-check-label w-100" for="materia-geografia">GEOGRAFIA</label></div>
                    <div class="form-check"><input class="form-check-input materia-checkbox" type="checkbox" name="materias" value="PRÁTICAS EMP." id="materia-praticas-emp"><label class="form-check-label w-100" for="materia-praticas-emp">PRÁTICAS EMP.</label></div>
                    <div class="form-check"><input class="form-check-input materia-checkbox" type="checkbox" name="materias" value="EST. AVANÇ. MAT." id="materia-est-avanc-mat"><label class="form-check-label w-100" for="materia-est-avanc-mat">EST. AVANÇ. MAT.</label></div>
                    <div class="form-check"><input class="form-check-input materia-checkbox" type="checkbox" name="materias" value="INGLÊS" id="materia-ingles"><label class="form-check-label w-100" for="materia-ingles">INGLÊS</label></div>
                    <div class="form-check"><input class="form-check-input materia-checkbox" type="checkbox" name="materias" value="LAB. INV. CIEN." id="materia-lab-inv-cien"><label class="form-check-label w-100" for="materia-lab-inv-cien">LAB. INV. CIEN.</label></div>
                    <div class="form-check"><input class="form-check-input materia-checkbox" type="checkbox" name="materias" value="ARTE" id="materia-arte"><label class="form-check-label w-100" for="materia-arte">ARTE</label></div>
                    <div class="form-check"><input class="form-check-input materia-checkbox" type="checkbox" name="materias" value="BIOLOGIA" id="materia-biologia"><label class="form-check-label w-100" for="materia-biologia">BIOLOGIA</label></div>
                    <div class="form-check"><input class="form-check-input materia-checkbox" type="checkbox" name="materias" value="HISTÓRIA" id="materia-historia"><label class="form-check-label w-100" for="materia-historia">HISTÓRIA</label></div>
                    <div class="form-check"><input class="form-check-input materia-checkbox" type="checkbox" name="materias" value="PORTUGUÊS" id="materia-portugues"><label class="form-check-label w-100" for="materia-portugues">PORTUGUÊS</label></div>
                    <div class="form-check"><input class="form-check-input materia-checkbox" type="checkbox" name="materias" value="QUÍMICA" id="materia-quimica"><label class="form-check-label w-100" for="materia-quimica">QUÍMICA</label></div>
                    <div class="form-check"><input class="form-check-input materia-checkbox" type="checkbox" name="materias" value="EDUCAÇÃO FÍSICA" id="materia-educacao-fisica"><label class="form-check-label w-100" for="materia-educacao-fisica">EDUCAÇÃO FÍSICA</label></div>
                    <div class="form-check"><input class="form-check-input materia-checkbox" type="checkbox" name="materias" value="APLI. INFO." id="materia-apli-info"><label class="form-check-label w-100" for="materia-apli-info">APLI. INFO.</label></div>
                    <div class="form-check"><input class="form-check-input materia-checkbox" type="checkbox" name="materias" value="PORA" id="materia-pora"><label class="form-check-label w-100" for="materia-pora">PORA</label></div>
                    <div class="form-check"><input class="form-check-input materia-checkbox" type="checkbox" name="materias" value="PORDP" id="materia-pordp"><label class="form-check-label w-100" for="materia-pordp">PORDP</label></div>
                    <div class="form-check"><input class="form-check-input materia-checkbox" type="checkbox" name="materias" value="LAB. MED. INT. SOC." id="materia-lab-med-int-soc"><label class="form-check-label w-100" for="materia-lab-med-int-soc">LAB. MED. INT. SOC.</label></div>
                    <div class="form-check"><input class="form-check-input materia-checkbox" type="checkbox" name="materias" value="LAB. PROC. CRIA." id="materia-lab-proc-cria"><label class="form-check-label w-100" for="materia-lab-proc-cria">LAB. PROC. CRIA.</label></div>
                    <div class="form-check"><input class="form-check-input materia-checkbox" type="checkbox" name="materias" value="FILOSOFIA" id="materia-filosofia"><label class="form-check-label w-100" for="materia-filosofia">FILOSOFIA</label></div>
                    <div class="form-check"><input class="form-check-input materia-checkbox" type="checkbox" name="materias" value="DES. MOD. NEG." id="materia-des-mod-neg"><label class="form-check-label w-100" for="materia-des-mod-neg">DES. MOD. NEG.</label></div>
                    <div class="form-check"><input class="form-check-input materia-checkbox" type="checkbox" name="materias" value="CPOC" id="materia-cpoc"><label class="form-check-label w-100" for="materia-cpoc">CPOC</label></div>
                    <div class="form-check"><input class="form-check-input materia-checkbox" type="checkbox" name="materias" value="EST. ADM. PÚBLICA" id="materia-est-adm-publica"><label class="form-check-label w-100" for="materia-est-adm-publica">EST. ADM. PÚBLICA</label></div>
                    <div class="form-check"><input class="form-check-input materia-checkbox" type="checkbox" name="materias" value="ORG. EMP. CONT. II" id="materia-org-emp-cont-ii"><label class="form-check-label w-100" for="materia-org-emp-cont-ii">ORG. EMP. CONT. II</label></div>
                    <div class="form-check"><input class="form-check-input materia-checkbox" type="checkbox" name="materias" value="OP. CONT. COM." id="materia-op-cont-com"><label class="form-check-label w-100" for="materia-op-cont-com">OP. CONT. COM.</label></div>
                    <div class="form-check"><input class="form-check-input materia-checkbox" type="checkbox" name="materias" value="PROJ. INT. II" id="materia-proj-int-ii"><label class="form-check-label w-100" for="materia-proj-int-ii">PROJ. INT. II</label></div>
                    <div class="form-check"><input class="form-check-input materia-checkbox" type="checkbox" name="materias" value="LEG. TRAB. PREV." id="materia-leg-trab-prev"><label class="form-check-label w-100" for="materia-leg-trab-prev">LEG. TRAB. PREV.</label></div>
                    <div class="form-check"><input class="form-check-input materia-checkbox" type="checkbox" name="materias" value="EST. A. LINGUAGENS" id="materia-est-a-linguagens"><label class="form-check-label w-100" for="materia-est-a-linguagens">EST. A. LINGUAGENS</label></div>
                    <div class="form-check"><input class="form-check-input materia-checkbox" type="checkbox" name="materias" value="EST. AVANÇ. MATEM" id="materia-est-avanc-matem"><label class="form-check-label w-100" for="materia-est-avanc-matem">EST. AVANÇ. MATEM</label></div>
                    <div class="form-check"><input class="form-check-input materia-checkbox" type="checkbox" name="materias" value="CUSTOS CONTÁBEIS" id="materia-custos-contabeis"><label class="form-check-label w-100" for="materia-custos-contabeis">CUSTOS CONTÁBEIS</label></div>
                    <div class="form-check"><input class="form-check-input materia-checkbox" type="checkbox" name="materias" value="ADM. PROD. SERV" id="materia-adm-prod-serv"><label class="form-check-label w-100" for="materia-adm-prod-serv">ADM. PROD. SERV</label></div>
                    <div class="form-check"><input class="form-check-input materia-checkbox" type="checkbox" name="materias" value="PROC.LOG.EMP" id="materia-proc-log-emp"><label class="form-check-label w-100" for="materia-proc-log-emp">PROC.LOG.EMP</label></div>
                    <div class="form-check"><input class="form-check-input materia-checkbox" type="checkbox" name="materias" value="EST. ECO. MER. E COM." id="materia-est-eco-mer-e-com"><label class="form-check-label w-100" for="materia-est-eco-mer-e-com">EST. ECO. MER. E COM.</label></div>
                    <div class="form-check"><input class="form-check-input materia-checkbox" type="checkbox" name="materias" value="SOCIOLOGIA" id="materia-sociologia"><label class="form-check-label w-100" for="materia-sociologia">SOCIOLOGIA</label></div>
                    <div class="form-check"><input class="form-check-input materia-checkbox" type="checkbox" name="materias" value="ADM. RH" id="materia-adm-rh"><label class="form-check-label w-100" for="materia-adm-rh">ADM. RH</label></div>
                    <div class="form-check"><input class="form-check-input materia-checkbox" type="checkbox" name="materias" value="ADM. FIN E ORÇ." id="materia-adm-fin-orc"><label class="form-check-label w-100" for="materia-adm-fin-orc">ADM. FIN E ORÇ.</label></div>
                    <div class="form-check"><input class="form-check-input materia-checkbox" type="checkbox" name="materias" value="ECO" id="materia-eco"><label class="form-check-label w-100" for="materia-eco">ECO</label></div>
                    <div class="form-check"><input class="form-check-input materia-checkbox" type="checkbox" name="materias" value="PDTCCA" id="materia-pdtcca"><label class="form-check-label w-100" for="materia-pdtcca">PDTCCA</label></div>
                    <div class="form-check"><input class="form-check-input materia-checkbox" type="checkbox" name="materias" value="TEC. INFO. ADM" id="materia-tec-info-adm"><label class="form-check-label w-100" for="materia-tec-info-adm">TEC. INFO. ADM</label></div>
                    <div class="form-check"><input class="form-check-input materia-checkbox" type="checkbox" name="materias" value="QTS" id="materia-qts"><label class="form-check-label w-100" for="materia-qts">QTS</label></div>
                    <div class="form-check"><input class="form-check-input materia-checkbox" type="checkbox" name="materias" value="PDTCC-DS" id="materia-pdtcc-ds"><label class="form-check-label w-100" for="materia-pdtcc-ds">PDTCC-DS</label></div>
                    <div class="form-check"><input class="form-check-input materia-checkbox" type="checkbox" name="materias" value="PW III" id="materia-pw-iii"><label class="form-check-label w-100" for="materia-pw-iii">PW III</label></div>
                    <div class="form-check"><input class="form-check-input materia-checkbox" type="checkbox" name="materias" value="PAM II" id="materia-pam-ii"><label class="form-check-label w-100" for="materia-pam-ii">PAM II</label></div>
                    <div class="form-check"><input class="form-check-input materia-checkbox" type="checkbox" name="materias" value="SIST. EMBARCADOS" id="materia-sist-embarcados"><label class="form-check-label w-100" for="materia-sist-embarcados">SIST. EMBARCADOS</label></div>
                    <div class="form-check"><input class="form-check-input materia-checkbox" type="checkbox" name="materias" value="IPS" id="materia-ips"><label class="form-check-label w-100" for="materia-ips">IPS</label></div>
                    <div class="form-check"><input class="form-check-input materia-checkbox" type="checkbox" name="materias" value="T.P.A" id="materia-tpa"><label class="form-check-label w-100" for="materia-tpa">T.P.A</label></div>
                    <div class="form-check"><input class="form-check-input materia-checkbox" type="checkbox" name="materias" value="BD I" id="materia-bd-i"><label class="form-check-label w-100" for="materia-bd-i">BD I</label></div>
                    <div class="form-check"><input class="form-check-input materia-checkbox" type="checkbox" name="materias" value="DESEN. SISTEMAS" id="materia-desen-sistemas"><label class="form-check-label w-100" for="materia-desen-sistemas">DESEN. SISTEMAS</label></div>
                    <div class="form-check"><input class="form-check-input materia-checkbox" type="checkbox" name="materias" value="BD II" id="materia-bd-ii"><label class="form-check-label w-100" for="materia-bd-ii">BD II</label></div>
                    <div class="form-check"><input class="form-check-input materia-checkbox" type="checkbox" name="materias" value="BD III" id="materia-bd-iii"><label class="form-check-label w-100" for="materia-bd-iii">BD III</label></div>
                    <div class="form-check"><input class="form-check-input materia-checkbox" type="checkbox" name="materias" value="PROGRAMAÇÃO WEB" id="materia-programacao-web"><label class="form-check-label w-100" for="materia-programacao-web">PROGRAMAÇÃO WEB</label></div>
                    <div class="form-check"><input class="form-check-input materia-checkbox" type="checkbox" name="materias" value="BANCO DE DADOS" id="materia-banco-dados"><label class="form-check-label w-100" for="materia-banco-dados">BANCO DE DADOS</label></div>
                    <div class="form-check"><input class="form-check-input materia-checkbox" type="checkbox" name="materias" value="REDES DE COMPUTADORES" id="materia-redes-computadores"><label class="form-check-label w-100" for="materia-redes-computadores">REDES DE COMPUTADORES</label></div>
                    <div class="form-check"><input class="form-check-input materia-checkbox" type="checkbox" name="materias" value="MATEMÁTICA APLICADA" id="materia-matematica-aplicada"><label class="form-check-label w-100" for="materia-matematica-aplicada">MATEMÁTICA APLICADA</label></div>
                    <div class="form-check"><input class="form-check-input materia-checkbox" type="checkbox" name="materias" value="TEORIAS DA ADMINISTRAÇÃO" id="materia-teorias-administracao"><label class="form-check-label w-100" for="materia-teorias-administracao">TEORIAS DA ADMINISTRAÇÃO</label></div>
                    <div class="form-check"><input class="form-check-input materia-checkbox" type="checkbox" name="materias" value="MATEMÁTICA FINANCEIRA" id="materia-matematica-financeira"><label class="form-check-label w-100" for="materia-matematica-financeira">MATEMÁTICA FINANCEIRA</label></div>
                    <div class="form-check"><input class="form-check-input materia-checkbox" type="checkbox" name="materias" value="LIDERANÇA ORGANIZACIONAL" id="materia-lideranca-organizacional"><label class="form-check-label w-100" for="materia-lideranca-organizacional">LIDERANÇA ORGANIZACIONAL</label></div>
                    <div class="form-check"><input class="form-check-input materia-checkbox" type="checkbox" name="materias" value="LEGISLAÇÃO TRABALHISTA" id="materia-legislacao-trabalhista"><label class="form-check-label w-100" for="materia-legislacao-trabalhista">LEGISLAÇÃO TRABALHISTA</label></div>
                </div>
            </div>
            <!-- Disponibilidade (pode ser melhorada para salvar no banco depois) -->
            <div class="row mb-3 mt-3">
                <div class="col-12">
                    <label class="form-label">Disponibilidade</label>
                    <div class="table-responsive">
                        <table class="table table-bordered text-center align-middle">
                            <thead>
                                <tr>
                                    <th>Dia/Horário</th>
                                    <th>Segunda</th>
                                    <th>Terça</th>
                                    <th>Quarta</th>
                                    <th>Quinta</th>
                                    <th>Sexta</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for idx, horario in [
                                    (1, '07:30 - 08:20'), (2, '08:20 - 09:10'), (3, '09:10 - 10:00'),
                                    (4, '10:20 - 11:10'), (5, '11:10 - 12:00'), (6, '12:00 - 12:50'),
                                    (7, '12:50 - 13:40'), (8, '13:40 - 14:40'), (9, '14:40 - 15:30'),
                                    ('N1', '18:10 - 19:00'), ('N2', '19:00 - 19:50'), ('N3', '19:50 - 20:40'),
                                    ('N4', '21:00 - 21:50'), ('N5', '21:50 - 22:40')
                                ] %}
                                <tr>
                                    <td>{{ loop.index <= 9 and loop.index|string + 'ª aula (' + horario + ')' or (loop.index-9)|string + 'ª aula noite (' + horario + ')' }}</td>
                                    {% for dia in ['Segunda', 'Terca', 'Quarta', 'Quinta', 'Sexta'] %}
                                        <td>
                                            <input type="checkbox" name="disponibilidade[{{ dia }}][{{ idx }}]">
                                        </td>
                                    {% endfor %}
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <button type="submit" class="btn btn-primary">
                <i class="fas fa-save me-2"></i>Salvar Professor
            </button>
        </form>
    </div>
</div>

<!-- Tabela de Professores -->
<div class="card shadow mb-5">
    <div class="card-header bg-success text-white">
        <h3 class="mb-0">
            <i class="fas fa-users me-2"></i>Professores Cadastrados
        </h3>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-striped table-hover" id="tabelaProfessores">
                <thead>
                    <tr>
                        <th>Nome</th>
                        <th>E-mail</th>
                        <th>Matérias</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody>
                    {% for prof in professores %}
                    <tr>
                        <td>{{ prof.nome }}</td>
                        <td>{{ prof.email }}</td>
                        <td>
                            {% set materias_prof = prof.disciplinas if prof.disciplinas else [] %}
                            {% for mat in materias_prof %}
                                {{ mat.nome }}{% if not loop.last %}, {% endif %}
                            {% endfor %}
                        </td>
                        <td>
                            <a href="{{ url_for('main.editar_professor', usuario_id=prof.id) }}" class="btn btn-sm btn-warning" title="Editar">
                                <i class="fas fa-edit"></i>
                            </a>
                            <a href="{{ url_for('main.excluir_professor', usuario_id=prof.id) }}" class="btn btn-sm btn-danger" title="Excluir" onclick="return confirm('Tem certeza que deseja excluir?')">
                                <i class="fas fa-trash"></i>
                            </a>
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="4">Nenhum professor cadastrado.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Seção de Geração Automática -->
<div class="card shadow" id="gerar-horarios">
    <div class="card-header bg-info text-white">
        <h3 class="mb-0">
            <i class="fas fa-cogs me-2"></i>Gerar Horários Automáticos
        </h3>
    </div>
    <div class="card-body">
        <p class="lead">Clique no botão abaixo para gerar os horários automaticamente com base nos professores cadastrados.</p>
        <a href="{{ url_for('main.grade_horaria') }}" class="btn btn-lg btn-info">
            <i class="fas fa-magic me-2"></i>Gerar Horários
        </a>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Script para atualizar o texto do dropdown das matérias e evitar fechamento ao clicar
    document.addEventListener('DOMContentLoaded', function () {
        const materiasDropdown = document.getElementById('materiasDropdown');
        const checkboxes = document.querySelectorAll('.materia-checkbox');

        checkboxes.forEach(chk => {
            chk.addEventListener('change', () => {
                const selected = Array.from(checkboxes).filter(c => c.checked).map(c => c.parentElement.textContent.trim());
                materiasDropdown.textContent = selected.length > 0 ? selected.join(', ') : 'Selecione as matérias...';
            });
        });

        // Previne fechamento ao clicar no dropdown-menu
        const dropdownMenus = document.querySelectorAll('.dropdown-menu-multiselect');
        dropdownMenus.forEach(menu => {
            menu.addEventListener('click', e => e.stopPropagation());
        });
    });
</script>
{% endblock %}